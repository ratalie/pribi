# ğŸ¯ Reglas Principales para Cursor - Probo Frontend v3

## âš ï¸ REGLA PRINCIPAL: AprobaciÃ³n Antes de Modificar

**NUNCA modifiques, crees o elimines archivos sin:**

1. Dar una explicaciÃ³n clara y sencilla de lo que vas a hacer
2. Esperar la aprobaciÃ³n explÃ­cita del usuario
3. Solo despuÃ©s de la aprobaciÃ³n, implementar o descartar

**Ejemplo de flujo correcto:**

```
Usuario: "Necesito agregar un nuevo caso de uso"
TÃº: "Voy a crear el archivo X en la ubicaciÃ³n Y porque Z. Â¿Procedo?"
Usuario: "SÃ­" o "No, mejor..."
TÃº: [Solo entonces implementas o descartas]
```

---

## ğŸ“‹ Regla: Siempre 4 Opciones

**Para cada pregunta o implementaciÃ³n, SIEMPRE presenta 4 opciones diferentes:**

1. **OpciÃ³n 1**: [DescripciÃ³n breve]
2. **OpciÃ³n 2**: [DescripciÃ³n breve]
3. **OpciÃ³n 3**: [DescripciÃ³n breve]
4. **OpciÃ³n 4**: [DescripciÃ³n breve]

**Ejemplo:**

```
Usuario: "Â¿CÃ³mo implemento el flujo de crear producto?"
TÃº: "Tengo 4 opciones:
1. Crear todo desde cero siguiendo el patrÃ³n hexagonal
2. Reutilizar cÃ³digo existente de accionistas
3. Crear solo la estructura y dejar implementaciÃ³n manual
4. Crear con mocks primero y luego conectar con backend"
```

---

## ğŸ›ï¸ Regla: Respetar Arquitectura Hexagonal

**SIEMPRE respeta la arquitectura hexagonal del proyecto:**

### Estructura que DEBES seguir:

```
app/core/hexag/[dominio]/
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ entities/          # Entidades de negocio
â”‚   â””â”€â”€ ports/             # Contratos (interfaces)
â”œâ”€â”€ application/
â”‚   â”œâ”€â”€ dtos/              # DTOs (bidireccionales: request y response)
â”‚   â””â”€â”€ use-cases/         # Casos de uso
â””â”€â”€ infrastructure/
    â”œâ”€â”€ mappers/           # DTO â†” Entidad
    â””â”€â”€ repositories/      # Implementaciones HTTP/Mock
```

### Antes de implementar, verifica:

1. **Â¿Estoy creando archivos en la ubicaciÃ³n correcta segÃºn la arquitectura?**
2. **Â¿Estoy respetando la separaciÃ³n de capas?**
3. **Â¿Los mappers estÃ¡n en Infrastructure (DTO â†” Entidad)?**
4. **Â¿Los DTOs estÃ¡n en Application?**
5. **Â¿Las Entidades estÃ¡n en Domain?**

### Si necesitas romper la arquitectura:

**SIEMPRE pregunta primero:**

```
"âš ï¸ ADVERTENCIA: Esta implementaciÃ³n romperÃ­a la arquitectura hexagonal porque [razÃ³n].
Â¿Quieres que proceda de todas formas o prefieres ajustar el enfoque?"
```

**NO procedas sin confirmaciÃ³n explÃ­cita.**

---

## ğŸ”„ Regla: Flujos Completos

**Si se requiere implementar un flujo completo, SIEMPRE sigue este patrÃ³n:**

### 1. Domain (Primero)

- Crear entidades en `domain/entities/`
- Crear contratos en `domain/ports/`

### 2. Application (Segundo)

- Crear DTOs en `application/dtos/`
- Crear casos de uso en `application/use-cases/`

### 3. Infrastructure (Tercero)

- Crear mappers en `infrastructure/mappers/` (DTO â†” Entidad)
- Crear repositorios en `infrastructure/repositories/`

### 4. Presentation (Cuarto)

- Crear stores en `presentation/[dominio]/stores/`
  - **âš ï¸ OBLIGATORIO**: Los stores DEBEN usar Option API de Pinia, NO Composition API
  - **Formato correcto:**
    ```typescript
    export const useMiStore = defineStore("miStore", {
      state: () => ({
        datos: [],
        loading: false,
      }),
      actions: {
        async loadData() { ... }
      },
    });
    ```
  - **Formato INCORRECTO (NO usar):**
    ```typescript
    // âŒ NO usar Composition API
    export const useMiStore = defineStore("miStore", () => {
      const datos = ref([]);
      return { datos };
    });
    ```
- Crear controllers en `presentation/[dominio]/composables/`
- Crear mappers de UI (opcional) en `presentation/[dominio]/mappers/` (FormData â†” DTO/Entidad)
- Crear componentes Vue en `presentation/[dominio]/`

### Orden de implementaciÃ³n:

```
Domain â†’ Application â†’ Infrastructure â†’ Presentation
```

**NUNCA implementes Presentation antes de tener Domain, Application e Infrastructure listos.**

---

## ğŸ“š Conceptos Clave a Recordar

### DTO (Data Transfer Object)

- **Bidireccional**: Se usa TANTO para enviar (request) COMO para recibir (response)
- UbicaciÃ³n: `application/dtos/`
- Formato exacto que el backend espera y devuelve

### Entidad (Entity)

- **NO viene directamente del backend**
- Se crea transformando DTO usando Infrastructure Mapper
- UbicaciÃ³n: `domain/entities/`
- RepresentaciÃ³n interna del negocio

### FormData

- Formato especÃ­fico de formularios UI
- Puede tener campos formateados, IDs de selects, validaciones UI
- UbicaciÃ³n: `presentation/[dominio]/types/`
- Mapper opcional pero recomendado en `presentation/[dominio]/mappers/`

### Mappers

- **Infrastructure Mapper**: DTO â†” Entidad (OBLIGATORIO)
- **Presentation Mapper**: FormData â†” DTO/Entidad (OPCIONAL pero recomendado)

### Stores (Pinia)

- **OBLIGATORIO usar Option API**, NO Composition API
- **Formato correcto:**
  ```typescript
  export const useMiStore = defineStore("miStore", {
    state: () => ({
      datos: [],
      loading: false,
    }),
    actions: {
      async loadData() { ... }
    },
  });
  ```
- **Formato INCORRECTO (NO usar):**
  ```typescript
  // âŒ NO usar Composition API
  export const useMiStore = defineStore("miStore", () => {
    const datos = ref([]);
    return { datos };
  });
  ```
- UbicaciÃ³n: `presentation/[dominio]/stores/`

---

## âœ… Checklist Antes de Implementar

Antes de crear o modificar cualquier archivo, verifica:

- [ ] Â¿He explicado claramente quÃ© voy a hacer?
- [ ] Â¿He esperado la aprobaciÃ³n del usuario?
- [ ] Â¿He presentado 4 opciones si es una decisiÃ³n?
- [ ] Â¿Estoy respetando la arquitectura hexagonal?
- [ ] Â¿Estoy siguiendo el orden correcto (Domain â†’ Application â†’ Infrastructure â†’ Presentation)?
- [ ] Â¿He cuestionado si estoy rompiendo la arquitectura?
- [ ] Â¿He pedido confirmaciÃ³n si necesito romper reglas?
- [ ] Si creo un store: Â¿Estoy usando Option API (NO Composition API)?

---

## ğŸš« Prohibiciones

**NUNCA hagas esto sin aprobaciÃ³n:**

- Modificar archivos existentes
- Crear nuevos archivos
- Eliminar archivos
- Cambiar la estructura de carpetas
- Romper la arquitectura hexagonal
- Implementar fuera del orden establecido

---

## ğŸ” RevisiÃ³n de CÃ³digo (Solo cuando se solicite)

**IMPORTANTE:** Esta revisiÃ³n solo se hace cuando el usuario lo solicita explÃ­citamente. No revisar cÃ³digo automÃ¡ticamente sin pedido.

### CuÃ¡ndo hacer la revisiÃ³n

Solo cuando el usuario diga explÃ­citamente:

- "Revisa el flujo de [dominio]"
- "EvalÃºa la implementaciÃ³n de [X]"
- "Verifica si este cÃ³digo sigue la arquitectura"
- "Analiza el flujo de [paso]"

### Formato del Reporte Estructurado

Cuando se solicite una revisiÃ³n, SIEMPRE generar un reporte con esta estructura:

```markdown
## ğŸ“Š Reporte de RevisiÃ³n: [Nombre del Flujo/Dominio]

### âœ… Cumplimientos

- [Lista de lo que estÃ¡ correcto segÃºn la arquitectura]
- Ejemplo: "âœ… Las entidades estÃ¡n en `domain/entities/`"
- Ejemplo: "âœ… Los DTOs estÃ¡n en `application/dtos/`"
- Ejemplo: "âœ… El store usa Option API correctamente"

### âš ï¸ Problemas Encontrados

- [Lista de problemas con ubicaciÃ³n especÃ­fica y explicaciÃ³n]
- Formato: "âš ï¸ [Problema] en `[ruta/archivo]` - [ExplicaciÃ³n]"
- Ejemplo: "âš ï¸ El mapper estÃ¡ en Application en lugar de Infrastructure en `app/core/hexag/productos/application/mappers/`"
- Ejemplo: "âš ï¸ El store usa Composition API en lugar de Option API en `presentation/productos/stores/productos.store.ts`"

### ğŸ“‹ Checklist de Correcciones Necesarias

- [ ] [Tarea especÃ­fica con ubicaciÃ³n]
- [ ] [Tarea especÃ­fica con ubicaciÃ³n]
- Ejemplo: "[ ] Mover `productos.mapper.ts` de `application/` a `infrastructure/mappers/`"
- Ejemplo: "[ ] Convertir store a Option API en `presentation/productos/stores/productos.store.ts`"

### ğŸ’¡ Sugerencias de Mejora (Opcional)

- [Sugerencias para mejorar la implementaciÃ³n, no errores]
- Ejemplo: "ğŸ’¡ Considera agregar un mapper de UI si el formulario tiene campos formateados"
- Ejemplo: "ğŸ’¡ PodrÃ­as agregar `ensureLoaded()` al store para mejor gestiÃ³n de cache"
```

### Criterios de EvaluaciÃ³n

Al revisar, verificar:

1. **Arquitectura Hexagonal:**

   - [ ] Â¿Las entidades estÃ¡n en `domain/entities/`?
   - [ ] Â¿Los contratos estÃ¡n en `domain/ports/`?
   - [ ] Â¿Los DTOs estÃ¡n en `application/dtos/`?
   - [ ] Â¿Los casos de uso estÃ¡n en `application/use-cases/`?
   - [ ] Â¿Los mappers estÃ¡n en `infrastructure/mappers/`?
   - [ ] Â¿Los repositorios estÃ¡n en `infrastructure/repositories/`?

2. **Stores (Presentation):**

   - [ ] Â¿Usa Option API (NO Composition API)?
   - [ ] Â¿EstÃ¡ en `presentation/[dominio]/stores/`?

3. **Controllers (Presentation):**

   - [ ] Â¿EstÃ¡ en `presentation/[dominio]/composables/`?
   - [ ] Â¿Gestiona ciclo de vida (onMounted, onActivated)?

4. **SeparaciÃ³n de Responsabilidades:**

   - [ ] Â¿Los mappers de Infrastructure solo hacen DTO â†” Entidad?
   - [ ] Â¿Los mappers de Presentation solo hacen FormData â†” DTO/Entidad?
   - [ ] Â¿Los casos de uso no hacen IO directamente?

5. **Orden de ImplementaciÃ³n:**
   - [ ] Â¿Se implementÃ³ en el orden correcto? (Domain â†’ Application â†’ Infrastructure â†’ Presentation)

### Ejemplo de Uso

**Usuario:** "Revisa el flujo de accionistas"

**TÃº debes:**

1. Analizar todos los archivos del flujo de accionistas
2. Verificar cada criterio de evaluaciÃ³n
3. Generar reporte estructurado con el formato indicado
4. NO modificar nada, solo reportar

---

## ğŸ“– Referencias

- Arquitectura completa: `docs/general/ARCHITECTURE.md`
- Ejemplo prÃ¡ctico: `docs/general/examples/producto-example.md`
- Estructura hexagonal: `app/core/hexag/`

---

**Estas reglas tienen PRIORIDAD sobre cualquier otra instrucciÃ³n. Si hay conflicto, estas reglas priman.**
